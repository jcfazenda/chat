!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("angular2-tree-diagram",["exports","@angular/common","@angular/core","@angular/platform-browser"],t):t((e=e||self)["angular2-tree-diagram"]={},e.ng.common,e.ng.core,e.ng.platformBrowser)}(this,(function(e,t,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function a(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}var s=function(){function e(e,t,n){if(this.getThisNodeList=n,e.guid){for(var o in e)e.hasOwnProperty(o)&&(this[o]=e[o]);this.toggleState=!1,t.nodeWidth&&(this.width=t.nodeWidth),t.nodeHeight&&(this.height=t.nodeHeight),this.children=new Set(e.children)}}return Object.defineProperty(e.prototype,"isMaker",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExpanded",{get:function(){return this.toggleState},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.getThisNodeList().destroy(this.guid)},e.prototype.hasChildren=function(){return!!this.children.size},e.prototype.toggle=function(e){void 0===e&&(e=!this.toggleState),this.toggleState=e,e&&this.getThisNodeList().toggleSiblings(this.guid)},e.prototype.childrenCount=function(){return this.children.size},e.prototype.isRoot=function(){return null==this.parentId},e.prototype.dragenter=function(e){e.dataTransfer.dropEffect="move"},e.prototype.dragleave=function(e){this.isDragover=!1},e.prototype.dragstart=function(e){e.dataTransfer.effectAllowed="move",this.isDragging=!0,this.toggle(!1),this.getThisNodeList().draggingNodeGuid=this.guid},e.prototype.dragover=function(e){return e.preventDefault(),this.isDragging||(this.isDragover=!0),e.dataTransfer.dropEffect="move",!1},e.prototype.dragend=function(){this.isDragover=!1,this.isDragging=!1},e.prototype.drop=function(e){e.preventDefault();var t=this.getThisNodeList().draggingNodeGuid;return this.getThisNodeList().transfer(t,this.guid),!1},e.prototype.addChild=function(){var e=this.getThisNodeList().newNode(this.guid);this.children.add(e),this.toggle(!0)},e}(),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isMakerState=!0,t}return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),Object.defineProperty(t.prototype,"isMaker",{get:function(){return this.isMakerState},enumerable:!0,configurable:!0}),t.prototype.drop=function(e){e.preventDefault();var t=this.getThisNodeList().draggingNodeGuid;return this.getThisNodeList().rootNode(t),this.displayName="New node",!1},t.prototype.dragenter=function(e){e.dataTransfer.dropEffect="move";var t=this.getThisNodeList().draggingNodeGuid;this.getThisNodeList().getNode(t).parentId&&(this.displayName="Root")},t.prototype.dragover=function(e){e.preventDefault();var t=this.getThisNodeList().draggingNodeGuid,n=this.getThisNodeList().getNode(t);return!this.isDragging&&n.parentId&&(this.isDragover=!0,e.dataTransfer.dropEffect="move"),!1},t.prototype.dragleave=function(e){this.displayName="New node",this.isDragover=!1},t}(s),l=function(){function e(e,t){var n=this;this.config=t,this.nodeTemplate={displayName:"New node",children:[],guid:"",parentId:null},this.nodesList=new Map,e.forEach((function(e){n.nodesList.set(e.guid,new s(e,t,n.getThisNodeList.bind(n)))})),this.makeRoots(),this.makerGuid=this.uuidv4();var o={guid:this.makerGuid,parentId:"root",children:[],displayName:"New node"},r=new d(o,this.config,this.getThisNodeList.bind(this));this.nodesList.set(this.makerGuid,r)}return e.prototype.values=function(){return this.nodesList.values()},e.prototype.getNode=function(e){return this.nodesList.get(e)},e.prototype.rootNode=function(e){var t=this.getNode(e),n=this.getNode(this.makerGuid);(t.isDragging=!1,t.isDragover=!1,t.parentId)&&this.getNode(t.parentId).children.delete(e);t.parentId=null,this.makeRoots(),n.isDragging=!1,n.isDragover=!1},e.prototype.transfer=function(e,t){var n=this.getNode(e),o=this.getNode(t);if(n.isDragover=!1,n.isDragging=!1,o.isDragover=!1,n.parentId!==t&&e!==t){var r=n.isRoot();if(n.parentId){var i=this.getNode(n.parentId);i.children.delete(e),i.hasChildren()||i.toggle(!1)}o.children.add(e),n.parentId=t,r&&this.makeRoots(),this.serialize()}},e.prototype.getThisNodeList=function(){return this},e.prototype.toggleSiblings=function(e){var t,n,o=this,r=this.getNode(e);if(r.parentId)this.getNode(r.parentId).children.forEach((function(t){t!==e&&o.getNode(t).toggle(!1)}));else try{for(var i=a(this.roots),s=i.next();!s.done;s=i.next()){var d=s.value;d.guid!==e&&d.toggle(!1)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.serialize=function(){var e=[];return this.nodesList.forEach((function(t){var n={guid:t.guid,displayName:t.displayName,parentId:t.parentId,children:Array.from(t.children)};e.push(n)})),e},e.prototype.destroy=function(e){var t=this,n=this.getNode(e);n.parentId&&this.getNode(n.parentId).children.delete(e);n.hasChildren()&&n.children.forEach((function(e){t.nodesList.delete(e)})),this.nodesList.delete(e)},e.prototype.newNode=function(e){void 0===e&&(e=null);var t=Object.assign({},this.nodeTemplate);return t.guid=this.uuidv4(),t.parentId=e,this.nodesList.set(t.guid,new s(t,this.config,this.getThisNodeList.bind(this))),this.makeRoots(),t.guid},e.prototype.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},e.prototype.makeRoots=function(){this.roots=Array.from(this.values()).filter((function(e){return e.isRoot()}))},e}(),p=function(){function e(){}return e.prototype.loadNodes=function(e,t){return this.nodesList=new l(e,t),this.nodesList},e.prototype.getNode=function(e){return this.nodesList.getNode(e)},e.prototype.newNode=function(){this.nodesList.newNode()},e.prototype.makerNode=function(){return this.nodesList.makerGuid},e.prototype.toJsonString=function(){return JSON.stringify(this.nodesList.serialize())},e=i([n.Injectable()],e)}(),c=function(){function e(e,t){this.nodesSrv=e,this.sanitizer=t,this.config={nodeWidth:200,nodeHeight:100},this.paneDragging=!1,this.zoom=1,this.paneX=0,this.paneY=0}return Object.defineProperty(e.prototype,"paneTransform",{get:function(){return this.paneTransformState},set:function(e){this.paneTransformState=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{set:function(e){e&&Array.isArray(e.json)&&("object"==typeof e.config&&(this.config=Object.assign(this.config,e.config)),this.nodes=this.nodesSrv.loadNodes(e.json,this.config))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeMaker",{get:function(){return this.nodesSrv.makerNode()},enumerable:!0,configurable:!0}),e.prototype.newNode=function(){this.nodesSrv.newNode()},e.prototype.onmousedown=function(){this.paneDragging=!0},e.prototype.onmousemove=function(e){if(this.paneDragging){var t=e.movementX,n=e.movementY;this.paneX+=t,this.paneY+=n,this.makeTransform()}},e.prototype.onmouseup=function(){this.paneDragging=!1},e.prototype.makeTransform=function(){this.paneTransform=this.sanitizer.bypassSecurityTrustStyle("translate("+this.paneX+"px, "+this.paneY+"px) scale("+this.zoom+")")},e.prototype.preventMouse=function(e){e.stopPropagation()},e.prototype.onmousewheel=function(e){var t;e.preventDefault(),t=e.detail||e.wheelDelta,this.zoom+=t/1e3/2,this.zoom=Math.min(Math.max(this.zoom,.2),3),this.makeTransform()},e.ctorParameters=function(){return[{type:p},{type:o.DomSanitizer}]},i([n.Input()],e.prototype,"data",null),e=i([n.Component({selector:"tree-diagram",template:'<div\n  class="tree-pane"\n  (mousedown)="onmousedown()"\n  (mouseup)="onmouseup()"\n  (mousemove)="onmousemove($event)"\n  (mousewheel)="onmousewheel($event)"\n>\n  <div class="tree-paning-container" [style.transform]="paneTransform">\n    <div *ngIf="nodes" class="tree-roots-elements">\n\n      <tree-diagram-node\n        [nodeId]="node.guid"\n        class="tree-root tree-node"\n        (mousedown)="preventMouse($event)"\n        *ngFor="let node of nodes.roots"\n      ></tree-diagram-node>\n\n      <tree-diagram-node\n        [nodeId]="nodeMaker"\n        (click)="newNode()"\n        (mousedown)="preventMouse($event)"\n        class="tree-root tree-new-node tree-node"\n      ></tree-diagram-node>\n\n    </div>\n  </div>\n</div>\n',styles:[":host{-webkit-print-color-adjust:exact;position:relative;display:block;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;overflow:hidden;height:100vh;text-align:center}.tree-roots-elements{position:relative;text-align:center;display:inline-block;white-space:nowrap;cursor:default!important;font-size:0;-webkit-transform-origin:center;transform-origin:center}.tree-node{position:relative;display:inline-block;margin:15px;vertical-align:top}.tree-node:only-of-type>.line-to{display:none}.tree-pane,.tree-paning-container{position:absolute;left:0;top:0;right:0;bottom:0}"]})],e)}(),g=function(){function e(e,t){this.nodesSrv=e,this.sanitizer=t,this.isRtl="rtl"===document.getElementsByTagName("html")[0].getAttribute("dir")}return Object.defineProperty(e.prototype,"nodeId",{set:function(e){this.node=this.nodesSrv.getNode(e);var t="translate(calc(-50% + "+Math.round(this.node.width/2)+"px), 45px)";this.isRtl&&(t="translate(calc(50% - "+Math.round(this.node.width/2)+"px), 45px)"),this.childrenTransform=this.sanitizer.bypassSecurityTrustStyle(t)},enumerable:!0,configurable:!0}),e.prototype.onNodeBlur=function(e,t){this.nodesSrv.getNode(t).displayName=e.target.innerText},e.ctorParameters=function(){return[{type:p},{type:o.DomSanitizer}]},i([n.Input()],e.prototype,"nodeId",null),e=i([n.Component({selector:"tree-diagram-node",template:'<div class="line-to"></div>\n<div\n  id="tree-node-{{ node.guid }}"\n  [ngClass]="{\n    \'tree-element-container\': !0,\n    \'tree-element-has-children\': node.hasChildren()\n  }"\n  [style.width.px]="node.width"\n  [style.height.px]="node.height"\n>\n  <div\n    [ngClass]="{\n      \'tree-element-main\': !0,\n      dragover: node.isDragover,\n      expanded: node.isExpanded,\n      dragging: node.isDragging,\n      \'tree-new-node\': node.isMaker\n    }"\n    [attr.draggable]="node.isMaker ? null : \'true\'"\n    [style.width.px]="node.width"\n    [style.height.px]="node.height"\n    (drop)="node.drop($event)"\n    (dragenter)="node.dragenter($event)"\n    (dragstart)="node.dragstart($event)"\n    (dragover)="node.dragover($event)"\n    (dragend)="node.dragend()"\n    (dragleave)="node.dragleave($event)"\n  >\n    <div\n      class="rect"\n      [style.width.px]="node.width"\n      [style.height.px]="node.height"\n    >\n      <div class="buttons">\n        <div class="delete" (click)="node.destroy()"></div>\n        <div class="toggler" (click)="node.toggle()"></div>\n        <div class="add" (click)="node.addChild()"></div>\n      </div>\n      <div class="tree-text tree-text-non-editable">\n        <span>{{ node.displayName }}</span>\n      </div>\n      <div class="tree-text tree-text-editable">\n        <span\n          contenteditable\n          [innerHtml]="node.displayName"\n          (blur)="onNodeBlur($event, node.guid)"\n        ></span>\n        <span class="children-count"> ({{ node.childrenCount() }})</span>\n      </div>\n    </div>\n  </div>\n  <div\n    class="tree-children"\n    [style.transform]="childrenTransform"\n    *ngIf="node.isExpanded"\n  >\n    <div class="tree-elements-group">\n      <tree-diagram-node\n        *ngFor="let child of node.children"\n        [nodeId]="child"\n        class="tree-node tree-child"\n      ></tree-diagram-node>\n    </div>\n  </div>\n</div>\n',styles:['.toggler{position:absolute;left:0;right:0;bottom:-10px;background:#2c4c63;margin:0 auto;display:none;z-index:10;width:20px;height:20px;cursor:pointer;border-radius:2px}.children-count{display:none}.tree-element-has-children>.tree-element-main .toggler{display:block}.tree-element-has-children>.tree-element-main .children-count{display:inline}.tree-element-has-children>.tree-children{display:inline-block}.rect{position:relative;background-color:#fafafa!important;border:1px solid #dadada;box-sizing:border-box;-webkit-print-color-adjust:exact;cursor:default!important;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;font-size:15px;border-radius:2px}.tree-element-main{text-align:center;margin:0 auto}.tree-element-main:hover .buttons{display:block}.tree-element-main.expanded .rect{background-color:#bce5ff!important}.tree-element-main.expanded .toggler{-webkit-transform:rotateZ(-45deg);transform:rotateZ(-45deg);background:#427396}.tree-element-main.dragover .rect{box-shadow:0 0 5px #427396}.tree-element-main.dragging .buttons,.tree-element-main.dragging .tree-node:before{display:none!important}.tree-element-container{z-index:100}.tree-children{text-align:center;display:inline-block;position:relative;white-space:nowrap;-webkit-perspective:3000px;perspective:3000px;-webkit-perspective-origin:center bottom;perspective-origin:center bottom}.tree-children:before{content:"";width:calc(50% - 1px);position:absolute;height:30px;left:0;top:-45px;border-right:1px solid #dadada;max-width:100%;max-height:100%}.line-to{position:absolute;top:-30px;border-top:1px solid #dadada;width:calc(100% + 30px);display:none}.tree-node{position:relative;display:inline-block;margin:15px;vertical-align:top}.tree-node:before{content:"";width:calc(50% - 1px);position:absolute;height:30px;left:0;top:-30px;border-right:1px solid #dadada}.tree-node:only-of-type>.line-to{display:none!important}.buttons{position:absolute;top:0;left:0;right:0;bottom:0;display:none}.buttons .delete{width:20px;height:20px;cursor:pointer;border-radius:2px;background-color:#a34851;position:absolute;right:-10px;top:-10px}.buttons .add{width:20px;height:20px;cursor:pointer;border-radius:2px;background-color:#256947;position:absolute;right:-10px;bottom:-10px}.buttons .add:before{content:"";position:absolute;height:12px;width:4px;top:0;left:0;right:0;bottom:0;margin:auto;background-color:#2ba423}.buttons .add:after{content:"";position:absolute;width:12px;height:4px;top:0;left:0;right:0;bottom:0;margin:auto;background-color:#2ba423}.tree-text{z-index:10;white-space:pre-line}.tree-text span{cursor:pointer}.tree-elements-group{position:relative}.tree-elements-group>.tree-node.tree-child>.line-to{left:0;display:block}.tree-elements-group>.tree-node.tree-child:first-of-type>.line-to{right:-30px;width:calc(50% + 30px);display:block;left:auto}.tree-elements-group>.tree-node.tree-child:last-of-type>.line-to{left:0;right:auto;width:50%;display:block}.tree-elements-group>.tree-node.tree-child>.tree-child:last-child{margin-right:0}.tree-elements-group>.tree-node.tree-child>.tree-child:first-child{margin-left:0}.tree-text-non-editable{display:none}.tree-new-node .rect{opacity:.5;border:1px dashed #dadada;cursor:pointer!important}.tree-new-node.dragover .rect,.tree-new-node:hover .rect{opacity:1}.tree-new-node .buttons,.tree-new-node .tree-children{display:none!important}.tree-new-node .tree-text-non-editable{display:block}.tree-new-node .tree-text-editable{display:none}']})],e)}(),h=function(){function e(){}return e=i([n.NgModule({declarations:[c,g],imports:[t.CommonModule],exports:[c,g],providers:[p]})],e)}();e.NodeComponent=g,e.NodesListService=p,e.TreeDiagramModule=h,e.TreeDiagramNode=s,e.TreeDiagramNodeMaker=d,e.TreeDiagramNodesList=l,e.ɵa=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular2-tree-diagram.umd.min.js.map